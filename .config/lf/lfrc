cmd open-within %{{
    case $(file --brief --mime-type "$f") in
        text/*) command lf -remote "send $id push e" ;;
        inode/*) command lf -remote "send $id push l" ;;
        *) devour xdg-open "$f" ;;
    esac
}}

# set window title to current directory
cmd on-cd &{{
    printf "\033]0;%s\007" "lf: `dirs +0`" >/dev/tty
}}

# also run at startup
on-cd

map <enter> open-within
map D delete
map e $$VISUAL "$f"

# lfcd
map q %{{
    command lf -remote "send $id :cd $OLDPWD; quit"
}}
map Q quit

set previewer stpv
set cleaner stpvimgclr
&stpvimg --listen $id
cmd on-quit $stpvimg --end $id
